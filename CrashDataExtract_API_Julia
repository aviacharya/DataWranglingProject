using Pkg,CSV
using DataFrames
using HTTP , JSON

#Declaring the URL
url="https://opendata.arcgis.com/datasets/a163c5addf2c4b7f9079f08751bd2e1a_0.geojson?where=crashYear%20%3E%3D%202018%20AND%20crashYear%20%3C%3D%202018"


response = HTTP.get(url)

#Parsing the HTTPS response to JSON format
crash_data=JSON.parse(String(response.body))

#Creating the dataframe with JSON response
global df=DataFrame(crash_data["features"][1]["properties"])
# Removing the columns with missing values
df = deletecols!(df, [:crashRPDir,:crashRPSH,:crashDirec,:crashRPNew,:roadLane])
#Appending the dataset
	for i = 1:length(crash_data["features"])
		 print(100*i/length(crash_data["features"]))
		 println( " percent data extract is completed")
		 datadict1 = crash_data["features"][i]["properties"]
		 df1=DataFrame(datadict1)
		 global df		 
		 df1 = deletecols!(df1, [:crashRPDir,:crashRPSH,:crashDirec,:crashRPNew,:roadLane])
		 df = append!(df1,df) 
	end

#Writing the file to output
CSV.write("CrashData.csv",df)
